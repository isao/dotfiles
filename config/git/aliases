[alias]
    ; list all git aliases
    aliases = config get --all --show-names --regexp ^alias[.]

;; Queries

    ; Name of the default branch; e.g. "main".
    default-branch = config get init.defaultBranch

    ; Name of the remote for the default branch; e.g. "up" or "origin".
    default-remote-name = !"git config get branch.$(git default-branch).remote"

    ; Commit where the current branch diverged from the default remote branch.
    fork-point = !"git merge-base HEAD $(git default-remote-name)/$(git default-branch)"

    ; List filenames for changes on the current branch.
    changed = changed-diff --name-only

    ; List filenames and stats for changes on the current branch.
    changed-stat = changed-diff --stat

    ; Show code changes on the current branch. Accepts `git diff` arguments.
    changed-diff = !"f() { git diff $(git fork-point) \"$@\"; }; f"

    ; Log commits on the current branch.
    changed-log = !"git lg HEAD...$(git fork-point)"

    ; <http://stackoverflow.com/questions/3065650>
    conflicts = diff --name-only --diff-filter=U

    ; Get the SHA of a ref (default is HEAD) without a trailing newline.
    sha = "!f() { printf %s $(git rev-parse ${1:-HEAD}); }; f"

;; Maintenance

    ; Fetch verbosely, but suppress "up-to-date" lines.
    fetchq = "!git fetch --prune --verbose 2>&1 | rg -v 'up to date'"

    ; Fetch in every repo reachable from cwd (within max depth `-d=3`).
    fetchcrazy = "!f() { fd '.git$' -H -t=d -d=3 -x git -C '{//}' fetchq; }; f"

    ; Preview the `git rmmerged` alias below.
    showmerged = !git branch --merged | egrep -v '^[^ ]|release/|master|main'

    ; Remove branches that are 1. merged with the current branch, 2. not checked
    ; out in another worktree, and 3. names don't contain "main" or "release/".
    rmmerged = !git showmerged | xargs -n 1 git branch -d

;; Committing

    fixup = commit --fixup

    squash = commit --squash

    ; Resume commit. Use the saved message from before a git commit error.
    recommit = commit -t .git/COMMIT_EDITMSG

    ; rebase interactively, with my common options.
    rbi = rebase --autostash --autosquash --interactive --no-verify

;; Logging

    ; log fuller
    lf = log --decorate --pretty=fuller --stat

    ; log shorter
    lg = log --oneline --decorate

    ; log shorter, ignoring commits brought in by a merge.
    lgg = log --oneline --decorate --first-parent

;; Stash

    ; Stash files that are not staged.
    stash-unstaged = stash save --keep-index

    ; Stash only the staged changes, from Hsieh Chin Fan.
    ;   https://github.com/typebrook/settings/blob/dev/gitconfig
    ; How it works:
    ; 1. Stash everything, but leave a copy of staged changes alone.
    ;       git stash --keep-index
    ; 2. Stash the remaining changes, the things that were staged.
    ;       git stash
    ; 3. Restore the original stash with all the changes.
    ;       git stash pop stash@{1}
    ; 4. Remove/reverse the previously staged changes from the working area.
    ;       git stash show --patch | git apply --reverse
    stash-staged = !git stash --keep-index && \
       git stash && \
       git stash pop stash@{1} && \
       git stash show --patch | git apply --reverse

    ; Usage: git stash-rename <stash> <message>
    ; <https://stackoverflow.com/a/35549615/515973>
    stash-rename = !'_() { rev=$(git rev-parse $1) && git stash drop $1 || exit 1 ; git stash store -m "$2" $rev; }; _'
